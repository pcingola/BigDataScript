<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Dependency operator - bds - Big Data Script programming language</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Dependency operator";
    var mkdocs_page_input_path = "dep_op.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> bds - Big Data Script programming language</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Manual</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../download/">Download</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../hello/">Hello world</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../language/">Language</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../special/">Special operators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_types/">Data types</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../functions/">Functions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../global_vars/">Global variables</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipelines/">Pipelines</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../sys/">Sys</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../task/">Tasks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../task_detached/">Tasks: Detached</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../task_imp/">Tasks: Improper</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../task_aws/">Tasks: Cloud AWS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../wait/">Wait</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Dependency operator</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#multiple-dependencies">Multiple dependencies</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-in-tasks">Using &lt;- in tasks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#automatic-task-dependency-detection">Automatic task dependency detection</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../goal/">Goal</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../remote_files/">Remote files</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../par/">Parallel execution</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../checkpoints/">Checkpoints</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../test_cases/">Test cases</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../debugger/">Debugger</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cmdline/">Command line parsing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help/">Command line help</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cleanup/">Cleanup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../bdscmdline/">bds command line</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../bdsconfig/">Config file</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../bds_vm/">Bds VM</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">bds - Big Data Script programming language</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Manual &raquo;</li>
        
      
    
    <li>Dependency operator</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="dependency-operator-">Dependency operator <code>&lt;-</code></h1>
<p>The dependency operator provides a simple way to see if a file needs to be updated (i.e. recalculated) with respect to some inputs.
For instance, when we already processed some files and have the corresponding results, we may save some work if the inputs have not changed (like "make" command).</p>
<p>We introduce the dependency operator <code>&lt;-</code> (pronounced 'dep') which is a "make" style operator.</p>
<p>The expression <code>out &lt;- in</code> is true if 'out' file needs to be updated.
More formally, the expression is true if the file name represented by the variable 'out' does not exist, is empty (zero length) or has a creation date before 'in'.
E.g.:</p>
<p>File <a href="bds/test_06.bds">test_06.bds</a></p>
<pre><code>#!/usr/bin/env bds

string inFile  = &quot;in.txt&quot;
string outFile = &quot;out.txt&quot;

# Create 'in.txt' if it doesn't exist
if( !inFile.exists() ) {
    task echo Creating $inFile; echo Hello &gt; $inFile
}

wait

# Create 'out.txt' only if needs to be updated resepct to 'in.txt'
if( outFile &lt;- inFile ) {
    task echo Creating $outFile; cat $inFile &gt; $outFile
}
</code></pre>
<p>When executing for the first time, both tasks are executed and both files ('in.txt' and 'out.txt') are created.</p>
<pre><code>$ ./test_06.bds
Creating in.txt
Creating out.txt
</code></pre>
<p>If we execute for a second time, since files have not changed, no <code>task</code> is executed.</p>
<pre><code>$ ./test_06.bds
$
</code></pre>
<p>If we now change the contents of 'in.txt', and run the script again, the second <code>task</code> will be executed (because 'out.txt' needs to be updated with respect to 'in.txt')</p>
<pre><code># Update 'in.txt'
$ date &gt; in.txt

# Since we updated the input file, the output must be recalculated
$ ./test_06.bds 
Creating out.txt
</code></pre>
<p><strong>Summary:</strong> If the file 'out.txt' is up to date with respect to 'in.txt', the following condition will be false and the <code>task</code> will not execute</p>
<pre><code>if( outFile &lt;- inFile ) {
    task echo Creating $outFile; cat $inFile &gt; $outFile
}
</code></pre>
<h3 id="multiple-dependencies">Multiple dependencies</h3>
<p>You can have a dependency operator expression <code>out &lt;- in</code>, where either <code>in</code> and <code>out</code> or both can be lists of files. 
The same rules apply: The operator is true if any out file is missing, zero length or the minimum of modification times in <code>out</code> is less than the maximum modificaton times in <code>in</code></p>
<p>This can be also used on lists:</p>
<pre><code>in1 := &quot;in1.txt&quot;
in2 := &quot;in2.txt&quot;
out := &quot;out.txt&quot;

if( out &lt;- [in1, in2] ) print(&quot;We should update $out\n&quot;)
</code></pre>
<p>or even:</p>
<pre><code>in1 := &quot;in1.txt&quot;
in2 := &quot;in2.txt&quot;
out1 := &quot;out1.txt&quot;
out2 := &quot;out2.txt&quot;

if( [out1, out2] &lt;- [in1, in2] ) print(&quot;We should update $out1 and $out2\n&quot;)
</code></pre>
<h3 id="using-in-tasks">Using <code>&lt;-</code> in <code>tasks</code></h3>
<p>This construction is so common that we allow for some syntactic sugar. </p>
<pre><code>task( outFile &lt;- inFile ) { 
    sys echo Creating $outFile; cat $inFile &gt; $outFile
}
</code></pre>
<p>The above syntax means that <code>task</code> will only be executed if the dependency is satisfied, i.e. <code>outFile</code> needs to be updated respect to <code>inFile</code>.</p>
<iframe width="640" height="390" src="http://www.youtube.com/embed/oSjhkRuc0I8" frameborder="0" allowfullscreen></iframe>

<h3 id="automatic-task-dependency-detection">Automatic task dependency detection</h3>
<p>Programming task dependencies can be difficult.
BDS can help by automatically inferring task dependencies and executing tasks in the correct order.</p>
<p>In this example, we have two tasks:</p>
<ul>
<li>The first task uses an input file 'in.txt', to create an intermediate file 'inter.txt' </li>
<li>The second task uses the intermediate file 'inter.txt' to create the ouptut file 'out.txt'.</li>
</ul>
<p>The script below does not have a <code>wait</code> statement. 
Instead <code>bds</code> automatically infers that the second task depends on the first one, and does not start execution until the first task begins.
Notice that we don't tell bds to wait for the first task to finish (there is no explicit <code>wait</code> statement). </p>
<p>File <a href="bds/test_07.bds">test_07.bds</a></p>
<pre><code>#!/usr/bin/env bds

# We use ':=' for declaration with type inference
inFile       := &quot;in.txt&quot;        
intermediate := &quot;inter.txt&quot;
outFile      := &quot;out.txt&quot;

task( intermediate &lt;- inFile) {
    sys echo Creating $intermediate; cat $inFile &gt; $intermediate; sleep 1 ; echo Done $intermediate
}

task( outFile &lt;- intermediate ) {
    sys echo Creating $outFile; cat $intermediate &gt; $outFile; echo Done $outFile
}
</code></pre>
<p>As a side note: We used the <code>:=</code> operator to declare variables using type inference. 
So we can write <code>inFile := "in.txt"</code> instead of <code>string inFile = "in.txt"</code>, which not only is shorter to type, but also makes the code look cleaner.</p>
<p>Now let's run the script</p>
<pre><code># Delete old file (if anY)
$ rm *.txt

# Create input file
$ date &gt; in.txt

# Run
$ ./test_07.bds 
Creating inter.txt
Done inter.txt
Creating out.txt
Done out.txt
</code></pre>
<p>Note how the second task is executed only after the first one finished.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../goal/" class="btn btn-neutral float-right" title="Goal">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../wait/" class="btn btn-neutral" title="Wait"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../wait/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../goal/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
